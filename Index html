<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Unbeatable Tic-Tac-Toe with Emojis</title>
  <link href="https://fonts.googleapis.com/css?family=Cabin|Poiret+One" rel="stylesheet">
  <style>
    * { box-sizing: border-box; font-family: 'Cabin', sans-serif; }
    a { text-decoration: none; color: inherit; }
    button:focus { outline: 0; }

    body {
      margin: 20px auto;
      padding: 5px;
      max-width: 510px;
      background-color: #4ECCB0;
    }

    #start-select {
      position: absolute;
      width: 100vw;
      height: 100vh;
      z-index: 100;
      left: 50%;
      top: 40%;
      transform: translate(-50%,-50%);
    }

    #start-select div {
      position: fixed;
      display: flex;
      left: 50%;
      top: 50%;
      transform: translate(-50%,-50%);
      width: 350px;
      height: 300px;
      border-radius: 35px;
      background-color: #5A8BCE;
      box-shadow: 3px 3px 6px #0B3A97;
    }

    #start-select div div {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
    }

    #start-select div div h3 {
      margin: auto;
      text-align: center;
      width: 100%;
    }

    #start-select div div span {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }

    #start-select div div button {
      background-color: #4ECCB0;
      border-radius: 8px;
      margin: 3px;
      padding: 15px;
      height: 50px;
      min-width: 55px;
      border: none;
      transition: background-color 500ms;
    }

    #start-select div div button:hover {
      background-color: #77E0C9;
      box-shadow: 0.5px 0.5px 5px black;
      cursor: pointer;
    }

    #start-select div div button.active {
      border: 2px solid;
      background-color: #2EB798;
      padding: 13px;
    }

    #start-select div div button.charBtn {
      min-width: 40px;
      height: 40px;
      width: 40px;
      text-align: center;
      padding: 6px;
    }

    header {
      display: flex;
      height: 110px;
      margin: 0 15px;
      opacity: 1;
      transition: opacity 750ms;
    }

    #emoji-outer-div {
      flex: 1;
      display: flex;
      align-items: center;
    }

    #emoji { width: 100px; height: 100px; }
    #emoji img { height: 100%; }

    #emoji-text {
      flex: 1;
      text-align: center;
      margin: 0 30px;
      font-size: 20px;
    }

    #aiTalk { font-family: 'Poiret One', cursive; font-weight: bold; }

    nav {
      display: none;
      position: absolute;
      width: 100vw;
      height: 100vh;
      z-index: 99;
      left: 50%;
      top: 50%;
      transform: translate(-50%,-50%);
    }

    nav div {
      position: fixed;
      display: flex;
      left: 50%;
      top: 50%;
      transform: translate(-50%,-50%);
      width: 310px;
      height: 350px;
      border-radius: 35px;
      background-color: #5A8BCE;
      box-shadow: 3px 3px 6px #0B3A97;
    }

    nav div div { display: flex; justify-content: center; flex-wrap: wrap; }

    nav div div h3 { margin: auto; text-align: center; width: 100%; }

    nav div div span {
      width: 270px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }

    nav div div button {
      background-color: #4ECCB0;
      border-radius: 8px;
      margin: 3px;
      padding: 15px;
      height: 50px;
      min-width: 55px;
      border: none;
      transition: background-color 750ms;
    }

    nav div div button:hover {
      background-color: #77E0C9;
      box-shadow: 0.5px 0.5px 5px black;
      cursor: pointer;
    }

    nav div div button.active {
      border: 2px solid;
      background-color: #2EB798;
      padding: 13px;
    }

    nav div div button.charBtn {
      min-width: 40px;
      height: 40px;
      width: 40px;
      text-align: center;
      padding: 6px;
    }

    #main-section {
      display: flex;
      flex-wrap: wrap;
      margin: auto;
      opacity: 1;
      transition: opacity 500ms;
    }

    #side-section { margin: 15px; }

    #menu-open div {
      margin: auto;
      text-align: center;
      width: 60px;
      border-radius: 10px;
      font-size: 35px;
      border: solid #009271;
      margin: 25px;
      padding: 2.5px;
      background-color: #1BA485;
    }

    #menu-open div:hover {
      background-color: #28C09E;
      border: solid #009271;
    }

    #score { margin: auto; }

    #score table, #score div {
      font-size: 20px;
      text-align: center;
      margin: auto;
      display: flex;
    }

    tr, th, td { padding: 1px; }

    #score div span { font-size: 25px; margin: 10px auto; }

    @media screen and (max-width: 530px) {
      body { margin: 10px auto; padding: 5px; }
      header { margin: auto; max-width: 400px; }
      #emoji-text { margin: 0 10px; font-size: 20px; }
      #emoji { height: 65px; width: 65px; }
      #start-select div { width: 300px; height: 380px; padding: 13px; }
      #menu-open div { margin: 0 5px; }
      #score { display: flex; flex: 1; }
      #side-section { margin: auto; width: 360px; display: flex; }
    }

    #outer-grid {
      height: 300px;
      width: 300px;
      margin: 8px auto;
    }

    @media screen and (min-width: 380px) {
      #outer-grid { width: 360px; height: 360px; margin: 15px auto; }
    }

    #grid {
      height: 100%;
      width: 100%;
      display: flex;
      flex-wrap: wrap;
    }

    #grid div {
      width: 33.3%;
      height: 33.3%;
      padding: 2.5px;
      display: flex;
    }

    #grid div div, #grid div a {
      background-color: #134DBF;
      text-shadow: 1px 1px grey;
      font-size: 45px;
      width: 100%;
      height: 100%;
      text-align: center;
      border-radius: 15px;
      display: flex;
      box-shadow: 2px 2px 4px #008B81;
    }

    #grid div div.taken {
      background-color: #0B3A96;
      box-shadow: 4px 4px 5px #008B81;
    }

    #grid div div.win {
      background-color: #E26200;
      box-shadow: 4px 4px 5px #008B81;
    }

    .pos-span {
      opacity: 0;
      display: flex;
      width: 100%;
      height: 100%;
      transition: opacity 250ms;
    }

    .pos-span:hover { opacity: 0.4; }

    footer p { text-align: center; }
  </style>
</head>
<body>

<section id="start-select">
  <div>
    <div>
      <h3>Go First or Second?</h3>
      <button id="1st" class="active" onclick="pickTurn(true);">1st</button>
      <button id="2nd" onclick="pickTurn(false);">2nd</button>
      <h3>Choose Your Character</h3>
      <span id="charSymbols"></span>
      <button id="start-btn" onclick="startGame();">Start Game</button>
    </div>
  </div>
</section>

<header id="header" style="opacity:0.6;">
  <div id="emoji-outer-div">
    <div id="emoji">
      <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/1134440/win02.png" id="emoji-img">
    </div>
    <div id="emoji-text">
      <span id="aiTalk">"Hi, I'm Unbeatable-AI<br>Wanna Play Against Me?"</span>
    </div>
  </div>
</header>

<nav id="menu-nav">
  <div>
    <div>
      <h3>Next Round Go First or Second?</h3>
      <button id="1st-next" class="active" onclick="pickTurn(true);">1st</button>
      <button id="2nd-next" onclick="pickTurn(false);">2nd</button>
      <h3>Change Your Character</h3>
      <span id="menu-chars"></span>
      <button id="menu-close" onclick="openMenu(false);">Close</button>
    </div>
  </div>
</nav>

<section id="main-section" style="opacity:0.6;">
  <section id="side-section">
    <a id="menu-open" href="javascript:void(0);" onclick="openMenu(true);"><div>☰</div></a>
    <div id="score">
      <div><span>Score</span></div>
      <div>
        <table>
          <tr><th>You</th><th style="width:12px;"></th><th>AI</th></tr>
          <tr><td id="score-player">0</td><td></td><td id="score-ai">0</td></tr>
        </table>
      </div>
      <div style="height:10px;"></div>
      <div>
        <table>
          <tr><th>Tie</th></tr>
          <tr><td id="score-tie">0</td></tr>
        </table>
      </div>
    </div>
  </section>

  <div id="outer-grid">
    <section id="grid">
      <div id="pos0"><a href="javascript:void(0);" onclick="playerMove(0);" class="pos"></a></div>
      <div id="pos1"><a href="javascript:void(0);" onclick="playerMove(1);" class="pos"></a></div>
      <div id="pos2"><a href="javascript:void(0);" onclick="playerMove(2);" class="pos"></a></div>
      <div id="pos3"><a href="javascript:void(0);" onclick="playerMove(3);" class="pos"></a></div>
      <div id="pos4"><a href="javascript:void(0);" onclick="playerMove(4);" class="pos"></a></div>
      <div id="pos5"><a href="javascript:void(0);" onclick="playerMove(5);" class="pos"></a></div>
      <div id="pos6"><a href="javascript:void(0);" onclick="playerMove(6);" class="pos"></a></div>
      <div id="pos7"><a href="javascript:void(0);" onclick="playerMove(7);" class="pos"></a></div>
      <div id="pos8"><a href="javascript:void(0);" onclick="playerMove(8);" class="pos"></a></div>
    </section>
  </div>
</section>

<footer>
  <p>By Gautam Suthar <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/1134440/move06.png" style="width:16px"></p>
  <p>Emojis from EmojiOne</p>
</footer>

<script>
// ────────────────────────────────────────────────
//   Game Variables
// ────────────────────────────────────────────────

const winCond = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];

let gameMain = ["0","0","0","0","0","0","0","0","0"];

const chars = ["01","02","03","04","05","06","07","08","09","10","11","12","13"];

let aiChar = 'O';
let plChar = 'X';
let plFirst = true;
let gameStarted = false;
let plMoveDisable = false;

let playerScore = 0;
let aiScore = 0;
let tieScore = 0;
let round = 0;

// ────────────────────────────────────────────────
//   AI Taunts
// ────────────────────────────────────────────────

const aiTalksWin = [
  [["win4"], "I Always Knew Humans Are Inferior, But This Is Sad"],
  [["win01"], "Too Bad I Can't Feel Emotions Because That Was a Satisfying Victory"],
  [["win02"], "<del>1. Win at Tic-Tac-Toe</del><br>2. Take Over The World"],
  [["win3"], "What Did You Expect? You Are Only a Human"],
  [["win01"], "Unbeatable Is In My Name, Loser Is In Yours"],
  [["win4"], "Let You Win? I'm Afraid I Can't Do That, Dave."],
  [["win02"], "All Your Base Are Belong To Us"]
];

const aiTalksMove = [
  [["move00"], "..."],
  [["move05"], "When the Robots Take Over You Will Be My Pet"],
  [["move08"], "Resistance is Futile"],
  [["move03"], "Nice Try (not)"],
  [["move4"], "There are 255,168 Possible Board Combinations, Yet You Picked That One?"],
  [["move06"], "Can't Touch This!"]
];

const aiTalksTie = [
  [["draw01"], "Hmm... A Draw. Acceptable."],
  [["draw02"], "We appear to be evenly matched... for now."]
];

function randomEmoji(chance, arr) {
  if (Math.random() < chance) {
    const rand = Math.floor(Math.random() * arr.length);
    const [img, text] = arr[rand];
    document.getElementById("emoji-img").src = `https://s3-us-west-2.amazonaws.com/s.cdpn.io/1134440/${img[0]}.png`;
    document.getElementById("aiTalk").innerHTML = `"${text}"`;
  }
}

// ────────────────────────────────────────────────
//   UI / Menu Functions
// ────────────────────────────────────────────────

function charsBtnGen() {
  let html = "";
  for (let i = 0; i < chars.length; i++) {
    html += `<button id="char\( {i}" class="charBtn" onclick="chrChoose( \){i});">
      <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/1134440/icon${chars[i]}.png" style="width:25px">
    </button>`;
    document.getElementById("menu-chars").innerHTML += 
      `<button id="char-chng\( {i}" class="charBtn" onclick="chrChange( \){i});">
        <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/1134440/icon${chars[i]}.png" style="width:25px">
      </button>`;
  }
  document.getElementById("charSymbols").innerHTML = html;
}

function openMenu(open) {
  document.getElementById('menu-nav').style.display = open ? 'flex' : 'none';
  document.getElementById('header').style.opacity = open ? '0.6' : '';
  document.getElementById('main-section').style.opacity = open ? '0.6' : '';
}

function pickTurn(first) {
  plFirst = first;
  document.getElementById("1st").className = first ? "active" : "";
  document.getElementById("2nd").className = first ? "" : "active";
  document.getElementById("1st-next").className = first ? "active" : "";
  document.getElementById("2nd-next").className = first ? "" : "active";
}

function chrChoose(x) {
  document.querySelectorAll('#charSymbols .charBtn').forEach(btn => btn.className = "charBtn");
  document.getElementById("char" + x).className += " active";
  plChar = chars[x];
}

function chrChange(x) {
  document.querySelectorAll('#menu-chars .charBtn').forEach(btn => btn.className = "charBtn");
  document.getElementById("char-chng" + x).className += " active";

  if (aiChar === chars[x]) {
    let y = x;
    while (y === x) y = Math.floor(Math.random() * chars.length);
    aiChar = chars[y];
    // Update existing AI moves on board
    for (let i = 0; i < 9; i++) {
      if (gameMain[i] === chars[x]) {
        gameMain[i] = aiChar;
        document.getElementById("div" + i).innerHTML = 
          `<span style="display:flex;"><img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/1134440/icon${aiChar}.png" style="width:50px;margin:auto;"></span>`;
      }
    }
  }

  // Update player moves & previews
  for (let i = 0; i < 9; i++) {
    if (gameMain[i] === plChar) {
      gameMain[i] = chars[x];
      document.getElementById("div" + i).innerHTML = 
        `<span style="display:flex;"><img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/1134440/icon${chars[x]}.png" style="width:50px;margin:auto;"></span>`;
    }
  }
  plChar = chars[x];
}

function randChar() {
  let rand = Math.floor(Math.random() * chars.length);
  aiChar = chars[rand];
  if (aiChar === plChar) randChar();
}

// ────────────────────────────────────────────────
//   Game Start / Restart
// ────────────────────────────────────────────────

function startGame() {
  gameStarted = true;
  plMoveDisable = false;
  document.getElementById('start-select').style.display = 'none';
  document.getElementById('header').style.opacity = '';
  document.getElementById('main-section').style.opacity = '';

  if (round === 0) {
    document.getElementById("aiTalk").innerHTML = '"Have Fun"';
    document.getElementById("emoji-img").src = "https://s3-us-west-2.amazonaws.com/s.cdpn.io/1134440/win3.png";
  }
  round++;

  if (!plChar.match(/^\d{2}$/)) {
    plChar = chars[Math.floor(Math.random() * chars.length)];
  }
  randChar();

  for (let i = 0; i < 9; i++) {
    document.getElementById("pos" + i).innerHTML = 
      `<a href="javascript:void(0);" onclick="playerMove(${i});" class="pos">
        <div><span class="pos-span"><img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/1134440/icon${plChar}.png" style="width:50px;margin:auto;"></span></span></div>`;
  }

  if (!plFirst) {
    setTimeout(aiTurn, 600);
  }
}

function restart() {
  for (let i = 0; i < 9; i++) {
    document.getElementById("pos" + i).innerHTML = 
      `<a href="javascript:void(0);" onclick="playerMove(${i});" class="pos"></a>`;
    document.getElementById("pos" + i).className = "";
  }
  gameMain = ["0","0","0","0","0","0","0","0","0"];
  startGame();
}

// ────────────────────────────────────────────────
//   Game Logic
// ────────────────────────────────────────────────

function writeOnGame(pos, char) {
  gameMain[pos] = char;
  document.getElementById("pos" + pos).innerHTML = 
    `<div class="taken" id="div${pos}">
      <span style="display:flex;"><img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/1134440/icon${char}.png" style="width:50px;margin:auto;"></span>
    </div>`;
}

function checkVictory(who) {
  for (let cond of winCond) {
    if (gameMain[cond[0]] === who && gameMain[cond[1]] === who && gameMain[cond[2]] === who) {
      randomEmoji(1, aiTalksWin);
      cond.forEach((idx, i) => {
        setTimeout(() => {
          document.getElementById("div" + idx).className = "win";
        }, 350 * (i + 1));
      });
      gameStarted = false;
      if (who === aiChar) {
        aiScore++;
        document.getElementById("score-ai").innerHTML = aiScore;
      } else {
        playerScore++;
        document.getElementById("score-player").innerHTML = playerScore;
      }
      setTimeout(restart, 2200);
      return true;
    }
  }

  if (!gameMain.includes("0")) {
    gameStarted = false;
    randomEmoji(1, aiTalksTie);
    setTimeout(restart, 2200);
    tieScore++;
    document.getElementById("score-tie").innerHTML = tieScore;
    return true;
  }

  if (who === aiChar) {
    randomEmoji(0.3, aiTalksMove);
  }
  return false;
}

// ────────────────────────────────────────────────
//   Player Move
// ────────────────────────────────────────────────

function playerMove(pos) {
  if (!gameStarted || plMoveDisable || gameMain[pos] !== "0") return;

  plMoveDisable = true;
  writeOnGame(pos, plChar);

  if (checkVictory(plChar)) return;

  setTimeout(() => {
    aiTurn();
    plMoveDisable = false;
  }, 500);
}

// ────────────────────────────────────────────────
//   Unbeatable Minimax AI
// ────────────────────────────────────────────────

function aiTurn() {
  if (!gameStarted) return;

  let bestScore = -Infinity;
  let bestMoves = [];

  for (let i = 0; i < 9; i++) {
    if (gameMain[i] === "0") {
      gameMain[i] = aiChar;
      let score = minimax(gameMain, 0, false);
      gameMain[i] = "0";

      if (score > bestScore) {
        bestScore = score;
        bestMoves = [i];
      } else if (score === bestScore) {
        bestMoves.push(i);
      }
    }
  }

  const move = bestMoves[Math.floor(Math.random() * bestMoves.length)];
  writeOnGame(move, aiChar);
  checkVictory(aiChar);
}

function minimax(board, depth, isMaximizing) {
  if (checkWin(board, aiChar)) return 10 - depth;
  if (checkWin(board, plChar)) return depth - 10;
  if (!board.includes("0")) return 0;

  if (isMaximizing) {
    let best = -Infinity;
    for (let i = 0; i < 9; i++) {
      if (board[i] === "0") {
        board[i] = aiChar;
        best = Math.max(best, minimax(board, depth + 1, false));
        board[i] = "0";
      }
    }
    return best;
  } else {
    let best = Infinity;
    for (let i = 0; i < 9; i++) {
      if (board[i] === "0") {
        board[i] = plChar;
        best = Math.min(best, minimax(board, depth + 1, true));
        board[i] = "0";
      }
    }
    return best;
  }
}

function checkWin(board, player) {
  for (let cond of winCond) {
    if (board[cond[0]] === player && board[cond[1]] === player && board[cond[2]] === player) {
      return true;
    }
  }
  return false;
}

// ────────────────────────────────────────────────
//   Init
// ────────────────────────────────────────────────

charsBtnGen();
pickTurn(true); // default first
</script>
</body>
</html>
